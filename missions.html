<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>Project - starfox</title>

	<meta charset="UTF-8">
  	<meta name="author" content="Michal Pruszkowski">
  	<meta name="description" content="">
 	<meta name="keywords" content="">
 	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

	 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

     <link rel="stylesheet" href="css/style.css">
</head>

<body id="missions_master_container">
	<div id="ui_top">
		<button type="button" id="action_btn" onclick="redirectToGameScreen()" data-sfxhover="version1" data-sfxclick="version1">Play</button>
	</div>
	
	<main id="missions_screen">
        <div id="mission_tile_1" class="mission_tile">
            <button type="button" id="mission_btn_1" onclick="missionSelect(this)" data-sfxhover="version1" data-sfxclick="version1">
                <img src="assets/icons/icon_galaxy.png" alt="">
            </button>
        </div>
        
        <div id="mission_tile_2" class="mission_tile">
            <button type="button" id="mission_btn_2" onclick="missionSelect(this)" data-sfxhover="version1" data-sfxclick="version1">
                <img src="assets/icons/icon_desert_planet.png" alt="">
            </button>
        </div>
<!--
        <div id="mission_tile_3" class="mission_tile">
            <button type="button" id="mission_btn_3" onclick="missionSelect(this)" data-sfxhover="version1" data-sfxclick="version1">
                <img src="assets/icons/icon_ice_planet.png" alt="">
            </button>
        </div>

        <div id="mission_tile_4" class="mission_tile">
            <button type="button" id="mission_btn_4" onclick="missionSelect(this)" data-sfxhover="version1" data-sfxclick="version1">
                <img src="assets/icons/icon_black_hole.png" alt="">
            </button>
        </div>

-->

    </main>

	<div id="ui_bottomRight">
        <div id="mission_summary_content">
            <section id="mission_details">
                <h3>Level: </h3>
                <h3 id="mission_name"></h3>
                <br>
                <br>
                <h5>Difficulty: </h5>
                <h5 id="mission_difficulty"></h5>
            </section>
    
            <img id="mission_avatar" src="assets/space_green_bck.png" alt="">
        </div>
	</div>

	<div id="ui_bottomLeft">
        <div id="mission_brief_content">
            <h3>Mission Brief</h3>
            <hr>
            <p id="mission_brief"></p>
        </div>
	</div>

    <div id="menu_window">
        <nav id="menu_content" class="list-group text-center mt-5">
            <a class="option_btn" href="hangar.html" data-sfxhover="version1" data-sfxclick="version1">Return To Hangar</a>
            <button class="option_btn" type="button" onclick="showOptionsMenu()" data-sfxhover="version1" data-sfxclick="version1">Options</button>
            <a class="option_btn" href="index.html?visited=true" data-sfxhover="version1" data-sfxclick="version1">Quit</a>
        </nav>
    </div>

    <div id="options_window">
        <div id="options_content" class="mt-5">
            <!--Options section is populated by JavaScript-->
            <section id="options_section"></section>

            <section id="options_buttons">
                <button class="option_btn" type="button" data-sfxhover="version1" data-sfxclick="version1">Reset</button>
                <button class="option_btn" type="button" onclick="saveOptions()" data-sfxhover="version1" data-sfxclick="version1">Save</button>

                <button class="option_btn" type="button" onclick="showMainMenu()" data-sfxhover="version1" data-sfxclick="version1">Back</button>
            </section>
        </div>
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<script src="./optionsHandler.js" type="module"></script>
<script type="module">
import {createAudioElementBck, assignSFXevents, setAudioUI} from './utilities/audioHandler.js';

//Load and play background music
//also load UI audio effects that are accesible from UI_SFX constant
    var bckMusicSrc = "./Data/Audio/Music/bck_missions_screen.mp3";
    var bckMusicTrackName = "bck_missions_screen";

    createAudioElementBck(bckMusicSrc, bckMusicTrackName, true);

    //calling setAudioUI() here is bad when also being called from optionsHandler.js. Need changes
    const UI_SFX = setAudioUI();

/////////////////////////////////////////////////////////////////////
    const local_user_data = localStorage.getItem('user_data') 
    ? JSON.parse(localStorage.getItem('user_data')) 
    : (localStorage.setItem('user_data', JSON.stringify(user_data)), JSON.parse(localStorage.getItem('user_data')));

    //debug
    //console.log(local_user_data);
    //////////////////

	document.addEventListener('keydown', event => {
		switch(event.code){
			case "Escape": //esc
			let menuWindow = document.getElementById("menu_window");

				if(menuWindow.style.display == "initial"){
					menuWindow.style.display = "none";
				
				} else {
					menuWindow.style.display = "initial";

				}

				break;
			}
		});



    async function getMissionDetails(levelName){

        var levelFilePath = './levels/' + levelName + '.js';
        var levelData = await import(levelFilePath);
        var missionDetails = levelData.LevelDetails;

        //console.log(missionDetails);

        document.getElementById("mission_name").innerHTML = missionDetails.missionName
        document.getElementById("mission_avatar").src = missionDetails.missionAvatarSrc;
        document.getElementById("mission_difficulty").innerHTML = missionDetails.missionDifficulty
        document.getElementById("mission_brief").innerHTML = missionDetails.missionBrief
    };



window.missionSelect = function(missionTile){
    /*
        <div id="mission_tile_1" class="mission_tile">
            <button type="button" id="mission_btn_1" onclick="missionSelect(this)">
                <img src="assets/bck_rock.png" alt="">
            </button>
        </div>
    */

    //lazy validation, needs improvemnts
        document.getElementById("action_btn").setAttribute("data-mission_selected", "selected");

    let missionTiles = document.getElementsByClassName("mission_tile");
    
    for (let i = 0; i < missionTiles.length; i++) {
        let element = missionTiles[i];
        element.style.backgroundImage = "url('./assets/ui/ui_tile.png')";
    }


    //missionTile.classList.add("active");
    missionTile.setAttribute("data-status", "active");
    missionTile.parentElement.style.backgroundImage = "url('./assets/ui/ui_tile_active.png')";

    switch (missionTile.id){
        case "mission_btn_1":
            local_user_data.userDetails.level = "level_1";
            localStorage.setItem('user_data', JSON.stringify(local_user_data));

            getMissionDetails(local_user_data.userDetails.level);

            break;
    
        case "mission_btn_2":
            local_user_data.userDetails.level = "level_2";
            localStorage.setItem('user_data', JSON.stringify(local_user_data));

            getMissionDetails(local_user_data.userDetails.level);

            break;

        case "mission_btn_3":
            local_user_data.userDetails.level = "level_3";
            localStorage.setItem('user_data', JSON.stringify(local_user_data));

            getMissionDetails(local_user_data.userDetails.level);

            break;

        case "mission_btn_4":
            local_user_data.userDetails.level = "level_4";
            localStorage.setItem('user_data', JSON.stringify(local_user_data));

            getMissionDetails(local_user_data.userDetails.level);

            break;
    }
}

assignSFXevents(UI_SFX);



window.redirectToGameScreen = function(){
     //again, lazy validation, needs improvemnts
    if(document.getElementById("action_btn").getAttribute("data-mission_selected")){
        window.location.href = "gameScreen.html";
    } else {
        alert("You didn't select any mission!");
    }
}
</script>
</html>